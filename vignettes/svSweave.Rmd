---
title: "svSweave - Sweave, Knitr and R Markdown Companion Functions"
author: "Philippe Grosjean (phgrosjean@sciviews.org)"
date: "`r Sys.Date()`"
output:
  rmarkdown::html_vignette:
    fig_caption: yes
vignette: >
  %\VignetteIndexEntry{svMisc - Miscellaneous Functions}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

The 'svSweave' package provides different functions to better manage Sweave and Knitr with LyX, a document processor that creates LaTeX code. These function are not detailed here. See their help page `?clean_lyx()`.

The package also provides functions to automatically enumerate and reference figures, tables and equations in R Markdown documents (an alternate mechanisms to 'bookdown' that works everywhere). Indeed, this feature is missing in the basic R Markdown documents. The various 'bookdown' templates provide a `\@ref(label)`, see [cross-reference](https://bookdown.org/yihui/bookdown/cross-references.html). The functions `fig()`, `tab()` and `eq()` provide a different mechanism to obtain a similar result: enumerated items and the possibility to cross-reference them in the text. Here an example of a numbered figure with its caption. In order to use these function, you must load the 'svSweave' package in a (setup) chunk before you use these functions:

```{r}
library(svSweave)
```

Now, you can use `fig()` to number the caption of a figure in `fig.cap=` (**look at the .Rmd file to see how this is implemented**):

```{r, fig.cap=fig("first-plot", "An example of a simple histogram.")}
hist(rnorm(50))
```

Now, you can reference this plot in the text (see `r fig("first-plot")`). It also works if the first reference appears **before** the figure itself^[Take care, however, that numbering is sequential from the first call (either cross-reference, or label). You cannot cross-reference the last figure at the beginning of the document... or that last figure will be numbered "Fig. 1"!], see `r fig("second-plot")`.

```{r, fig.cap=fig("second-plot", "A second plot as an example.")}
boxplot(rnorm(50))
```

The same principle works for table, for instance, see `r tab("a-table")`.

```{r}
knitr::kable(head(iris), caption = tab("a-table", "The few first lines of the `iris` dataset."))
```

Finally, numbered display equations can also be constructed and cross-referenced. In both cases you use `eq()` with a label, but to label it, you omit to quote the label, and quotes are required for the reference part. The labelling must occur inside a **display equation** presented between two double dollar signs. Take care also that the label must also be a syntactically correct name (using only letters, numbers or _).

$$x=\frac{-b \pm \sqrt{b^2 - 4ac}}{2a} `r eq(my_equation)`$$

... and I can reference Eq.\ `r eq("my_equation")` like this.

> Remember that the enumeration of figures and tables are calculated as first arrived-first served. This is the correct order in R Markdown, but with R Notebooks where you may calculate chunks in a different order, you will end up with a strange succession of the numbers, unless you reset everything! To reset numbering, you call `fig(reset = TRUE)` or `tab(reset = TRUE)`.
